## What is CI/CD

[原文链接](https://opensource.com/article/18/8/what-cicd)


### 1. quick summary
&emsp;&emsp;软件交付管道以快速的、自动化的、可重复的方式从源码生成发布版本。
> 1. 如何完成这项工作的总体设计称为**持续性交付(continous delivery)**；
> 2. 启动组装线的过程称为**持续性集成(continous integeration)**；
> 3. 确保质量的过程称为**持续性测试**；
> 4. 将最终的产品提供给用户的过程称为**持续性部署**；

### 2. what does "continous" mean?
&emsp;&emsp;持续并不意味这“一直在运行”，而是“随时可运行”
+ **频繁发布：**

  ​	持续实践背后的目标是能够频繁地交付高质量的软件，此处的交付频率也是可变的。有的是一天、一个月、一个季度，有的则是一天内交付多次。最终的目的就是在可重复、可靠的过程中最终为用户提供高质量的软件更新。

+ **自动化流程：**

  ​	构建、测试、分析、版本控制，以及某些情况下的部署都是自动化的。

+ **可重复：**

  ​	如果我们把某个固定的历史版本的代码作为输入，我们应该得到对应相同的可交付产出。这就意味着可以对管道中的交付流程做相对应的版本控制和重建。

+ **快速迭代：**

  ​	预期的持续过程都会以高效的方式将源码转换成交付物，自动化会负责大部分的工作。

### 3. what is a "continous delivery pipeline"?

&emsp;&emsp;将源代码转换成可发布版本的产品的多个不同的任务task和作业job串联成一个**软件管道**。一个自动流程成功完成后会启动管道中的下一个流程。

### 4. how dose continous delivery pipeline work?

&emsp;&emsp;管道的实现各有不同，有很多程序应用被应用到管道上，作用为源码追踪，构建，测试，指标采集，版本管理等各个方面。但是整体工作流大体是一致的。
&emsp;&emsp;每个作业可能使用不同的技术或多种技术。关键是作业是自动化的、高效的，并且可重复的。如果作业成功，则工作流管理器将触发管道中的下一个作业。如果作业失败，工作流管理器会向开发人员、测试人员和其他人发出警报，以便他们尽快纠正问题。这个过程是自动化的，所以比手动运行一组过程可更快地找到错误。这种快速排错称为快速失败fail fast，并且在抵达管道端点方面同样有价值。

### 5. what is meant by "fail fast"

&emsp;&emsp;管道的工作之一就是快速处理变更，另一个是监视创建发布的不同任务/作业。由于编译失败或是测试未通过的代码可以阻止管道继续运行，因此快速通知用户此类情况是非常重要的。**快速失败是指在管道流程中尽快发现问题并且快速通知用户的方式，这样可以及时修正问题并重新提交代码以便使管道得以再次运行。**通常在管道流程中可通过查看历史记录来确定是谁做了那次修改并且通知此人所在的团队。

### 6. do all the parts of a continous delivery pipeline have to be automated?

&emsp;&emsp;管道的所有部分都应该是自动化的，但是有一些部分人为干预是有意义的。比如用户的验收测试(user-acceptance-testing)；部署到生产环境时，用户希望拥有更多的人为控制；当然如果代码无法正确运行，则需要人为干预。

### 7. what is continous integeration?

&emsp;&emsp;基本思想是让一个自动化过程监测一个或者多个源代码仓库是否有变更。当变更被推送到仓库时，它会监测更改、下载副本、构建并运行任何相关的单元测试。

### 8. how does continous integeration detect changes?

&emsp;&emsp;目前的监控程序通常是通过像*Jenkins*(詹金斯)这样的应用程序，它还协调管道中运行的所有(或大多数)的进程，监视变更是其功能之一。
> 监测变更有以下几种方式
    > 1. 轮询：监测程序反复询问代码管理系统。
    > 2. 定期：监测程序被配置为定期启动构建，无论源码是否有变更。会增加额外的成本。
    > 3. 推送：代码管理系统被配置为提交变更到仓库时将“推送”一个通知到监测程序。可以使用webhook进行实现。

### 9. what are "pre-checks"?

&emsp;&emsp;指在代码引入仓库进行持续性集成之前，可以进行测试构建(test building)和代码审查(code review)。但是有一些管道也将这部分放入监控流程/工作流中的一部分。
&emsp;&emsp;example: *Gerrit*允许在开发人员推送代码之后，在允许进入Git远程仓库之前进行正式的代码审查、验证、测试构建。

### 10. what are "unit tests"？

&emsp;&emsp;单元测试也称为提交测试，是由开发人员编写的小型的专项测试，以确保新代码独立工作。独立的意思是“不依赖或调用其它不可以直接访问的代码，也不依赖外部的数据源或是其它模块”。如果说运行代码需要这样的依赖关系，那么这些资源可以用模拟mock来实现(就是我们可以创建一个可以替代实际对象的对象，这个模拟对象可以通过特定的参数调用特定的方法，并且还能返回预期的结果)。
&emsp;&emsp;一种称为test-driven-develop的模型被要求将首先设计单元测试作为清楚地验证代码功能的基础。开发人员在本地的工作环境中编写或更新代码，并通过单元测试来确保新开发的功能或方法正确。而这些测试通常采用的是断言的形式。

### 11. what is continous testing?

&emsp;&emsp;是指代码通过持续交付管道时运行扩展范围的自动化测试实践。单元测试通常与构建过程集成，作为持续集成阶段的一部分，并专注于和其它与之交互的代码隔离的测试。

> 其它各种类别的测试还有：
    > 1. 集成测试：验证组建和服务组合在一起是否正常
    > 2. 功能测试：验证产品中执行功能的结果是否符合预期
    > 3. 验收测试：根据可接受的标准验证产品的某些特征，如性能、可伸缩性、抗压能力和容量

&emsp;&emsp;所有的这些功能可能并不存在于自动化的管道中，并且一些测试类型的界限也并不清晰。但是，在交付管道中持续测试的目标适中是相同的。**通过持续的测试级别证明代码的质量，并且可以在正在进行的发布中使用。**

### 12. Besidest testing, what other kinds of validations can be done against code in the pipeline?

&emsp;&emsp;除了测试是否通过以外，还有一些应用程序可以告诉我们**测试用例执行的源代码的行数**。这也是可以衡量代码指标的例子。比如工具Java(JaCoCo)、SonarQube。

### 13. what is continous delivery?

&emsp;&emsp;持续性交付是指整个流程链(管道)，它自动监测源码的变更并且通过构建、测试、打包和相关操作运行它们以生成可以部署的版本，基本上没有任何的人为干预。
&emsp;&emsp;持续性交付在软件开发过程中的目标是：自动化、效率、可靠性、可重复性、质量保障(通过持续性测试)
&emsp;&emsp;持续性交付包括：**持续集成(自动监测源代码的变更，执行构建过程，运行单元测试，验证变更)、持续性测试(对代码各种测试以保证代码质量)、持续部署(可选，通过管道发布版本自动提供给用户)。**

### 14. how are multiple versions idetified/tracked in pipelines?

&emsp;&emsp;版本控制是持续性交付和管道的关键概念；持续意味着能够*经常集成*新代码并提供更新版本，但是不意味着每个人都想要最新的、最好的版本。**因此管道创建并轻松存储和访问的这些版本化对象非常重要。**
&emsp;&emsp;在管道中从源代码创建的对象通常可以称为artifact，artifact在构建时应该有应用于它们的版本。将版本好分配给工件的推荐策略称为**语义化版本控制**

> 语义版本号有三个部分
    > 1. 主要版本(major): 主要版本仅针对不兼容的 API 更改而递增。
    > 2. 次要版本(minor): 当以向后兼容backward-compatible的方式添加功能时，次要版本会增加。
    > 3. 补丁版本(patch): 当进行向后兼容的版本 bug 修复时，补丁版本会增加。

### 15. how are artifacts "promoted"?

&emsp;&emsp;团队可以为artifacts分配分销(promotion)级别以指示适用于测试、生产等环境或用途，可以使用Jenkins、Artifactory等应用程序进行分销。或者还有一个简单的方案：可以在版本号字符串的末尾添加标签。

### 16. how are multiple versions of artifacts stored and accessed?

&emsp;&emsp;从源代码构建的版本化工件可以通过管理工件仓库artifact repository的应用程序进行存储。工件仓库就像构建工件的版本控制工具一样。像 Artifactory 或 Nexus 这类应用可以接受版本化工件，存储和跟踪它们，并提供检索的方法。管道用户可以指定他们想要使用的版本，并在这些版本中使用管道。

### 17. what is continous deployment?

&emsp;&emsp;是指能够自动提交持续交付管道中发布版本给最终用户使用的想法。这里有一个重点是，仅仅因为可以进行持续部署并不意味着始终部署来自管道的每组交付成果。它指的是，通过管道每套可交付成果都被证明是“可部署的”。这在很大程度上是由持续测试的连续级别完成的。管道构建的发布成果是否被部署是可由人工决策的。

### 18. What are some ways to test out deployments before fully deploying to all users?
&emsp;&emsp;由于必须回滚/撤销对所有用户的部署可能是一种代价高昂的情况。
#### 18.1 Blue/green testing/deployments

&emsp;&emsp;在这种部署软件的方法中，维护了两个相同的主机环境，一个是生产环境，一个是预发布环境。

#### 18.2 Canary testing/deployment



