# 为什么我的MySQL会抖一下

[TOC]
----------------------

## 你的SQL语句为什么变慢了
**脏页：**当内存数据和磁盘数据页的数据不同的时候，这个内存页为脏页；**干净页：**内存数据写入磁盘以后，内存和磁盘上的数据页就一样了。平时我们的更新动作其实就是一个写内存和写日志的动作。有时候平时都执行地很快的语句会突然变得很慢，这时候就很有可能是因为MySQL在进行**刷脏**。

## 什么情况下会引发刷脏
+ 1. redo log上面的空间用完了
    这时候InnoDB会停止所有的更新操作，把checkpoint向前推进，redo log留出空间继续书写。checkpoint向前推进的部分，就是把对应的脏页全部刷到磁盘上面。
    + 性能
        这种情况是InnoDB要尽量避免的，出现这种情况的时候整个系统的更新全部都不能进行了。
+ 2. 系统内存不足
    这个时候系统需要淘汰一些数据页，空出内存给别的数据页使用。如果淘汰掉的是脏页，就会将脏页书写到磁盘上面。
    + 性能
        这种情况是常态，InnoDB使用缓冲池(buffer pool)进行管理内存。
    + buffer pool
        buffer pool 中的内存页有三种不同的类型
        + 1. 还没有使用的
        + 2. 使用了并且是干净页
        + 3. 使用了并且是脏页
+ 3. MySQL认为系统空闲的时候
+ 4. MySQL正常关闭的时候
    这时候就会将内存中所有的脏页都刷到磁盘上。这样下次MySQL启动的时候，就可以直接从磁盘上面读数据，启动速度会很快。